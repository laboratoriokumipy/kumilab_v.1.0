<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorios Kumi - Cat√°logo Premium</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Sistema de Dise√±o Moderno */
        :root {
            --color-bg-primary: #0f172a;
            --color-bg-secondary: #1e293b;
            --color-bg-card: rgba(30, 41, 59, 0.7);
            --color-accent: #10b981;
            --color-accent-hover: #059669;
            --color-text-primary: #f8fafc;
            --color-text-secondary: #cbd5e1;
            --color-text-muted: #94a3b8;
            --color-border: #334155;
            --color-border-light: #475569;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-info: #0ea5e9;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 8px 16px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.3);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--color-bg-primary) 0%, #020617 100%);
            color: var(--color-text-primary);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* Header Premium */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--color-accent), var(--color-accent-hover));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            position: relative;
            transition: var(--transition);
        }

        .logo-icon:hover {
            transform: scale(1.05);
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            width: 28px;
            height: 28px;
            background: transparent;
            border: 3px solid var(--color-bg-primary);
            border-radius: 50%;
        }

        .logo-icon::after {
            content: 'üåø';
            font-size: 18px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .logo-text h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--color-text-primary), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 0.875rem;
            color: var(--color-accent);
            font-weight: 500;
            margin-top: 0.25rem;
        }

                .logo-img {
            height: 52px;     /* ajusta seg√∫n el alto que quieras */
            width: auto;
            display: block;
            object-fit: contain;
        }


        .nav-buttons {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .nav-btn {
            position: relative;
            width: 48px;
            height: 48px;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
        }

        .nav-btn:hover {
            background: var(--color-bg-secondary);
            color: var(--color-accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .nav-btn.admin-btn {
            background: linear-gradient(135deg, var(--color-warning), #d97706);
            color: var(--color-bg-primary);
            border: none;
            width: auto;
            padding: 0 1.25rem;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .nav-btn.admin-btn:hover {
            box-shadow: 0 8px 16px rgba(245, 158, 11, 0.3);
        }

        .badge, .admin-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--color-accent);
            color: var(--color-bg-primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .admin-badge {
            background: var(--color-danger);
            color: white;
        }

        /* Hero Section Redise√±ado */
        .hero {
            padding: 4rem 0 3rem;
        }

        .hero-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        @media (min-width: 1024px) {
            .hero-grid {
                grid-template-columns: 3fr 2fr;
            }
        }

        .hero-card {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
        }

        .hero-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4);
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--color-text-primary) 0%, var(--color-accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .hero-subtitle {
            font-size: 1.5rem;
            color: var(--color-accent);
            font-weight: 500;
            margin-bottom: 1.5rem;
        }

        .hero-description {
            font-size: 1.125rem;
            color: var(--color-text-secondary);
            margin-bottom: 2rem;
            line-height: 1.7;
        }

        .hero-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 2.5rem;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 9999px;
            font-size: 0.875rem;
            color: var(--color-accent);
            font-weight: 500;
            transition: var(--transition);
        }

        .tag:hover {
            background: rgba(16, 185, 129, 0.2);
            transform: translateY(-2px);
        }

        .tag i {
            font-size: 0.875rem;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1.75rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            border: none;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-accent), var(--color-accent-hover));
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: var(--color-text-secondary);
            border: 1px solid var(--color-border-light);
        }

        .btn-outline:hover {
            background: var(--color-bg-secondary);
            color: var(--color-accent);
            border-color: var(--color-accent);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--color-danger), #dc2626);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--color-warning), #d97706);
            color: white;
        }

        /* Metrics Card */
        .metrics-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metrics-card h3::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--color-border);
            margin-left: 0.5rem;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.5);
            border-radius: var(--radius-sm);
            margin-bottom: 0.75rem;
            transition: var(--transition);
        }

        .metric-item:hover {
            background: rgba(30, 41, 59, 0.7);
        }

        .metric-label {
            color: var(--color-text-muted);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .metric-value.green {
            color: var(--color-accent);
        }

        .metric-value.cyan {
            color: var(--color-info);
        }

        /* About Section */
        .about-section {
            padding: 4rem 0;
        }

        .about-card {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
        }

        .about-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2.5rem;
            background: linear-gradient(135deg, var(--color-text-primary), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .about-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2.5rem;
            margin-bottom: 2.5rem;
        }

        @media (min-width: 768px) {
            .about-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        .about-text h3 {
            font-size: 1.5rem;
            color: var(--color-accent);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .about-text p {
            color: var(--color-text-secondary);
            margin-bottom: 1.25rem;
            line-height: 1.7;
        }

        .feature-item {
            display: flex;
            gap: 1.25rem;
            padding: 1.25rem;
            background: rgba(30, 41, 59, 0.5);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--color-accent);
            transition: var(--transition);
        }

        .feature-item:hover {
            transform: translateX(4px);
            background: rgba(30, 41, 59, 0.7);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-accent);
            flex-shrink: 0;
            font-size: 1.25rem;
        }

        .feature-text h4 {
            color: var(--color-text-primary);
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .feature-text p {
            color: var(--color-text-muted);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .certifications {
            margin-top: 2.5rem;
            padding: 1.75rem;
            background: rgba(16, 185, 129, 0.05);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: var(--radius-md);
        }

        .certifications h4 {
            color: var(--color-accent);
            font-size: 1.25rem;
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
        }

        .cert-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        @media (min-width: 768px) {
            .cert-list {
                grid-template-columns: 1fr 1fr;
            }
        }

        .cert-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--color-text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .cert-item i {
            color: var(--color-accent);
            font-size: 1rem;
        }

        /* Filters Section */
        .filters {
            padding: 3rem 0;
        }

        .filters-card {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 1.75rem;
            box-shadow: var(--shadow-md);
        }

        .filters-top {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .filters-top {
                grid-template-columns: 2fr 1fr;
            }
        }

        @media (min-width: 1024px) {
            .filters-top {
                grid-template-columns: 3fr 1fr;
            }
        }

        .search-box {
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
            font-size: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .search-input::placeholder {
            color: var(--color-text-muted);
        }

        .sort-select {
            padding: 0.875rem 1rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.25rem;
            padding-right: 2.5rem;
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .category-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1.25rem;
        }

        .chip {
            padding: 0.5rem 1rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--color-border);
            border-radius: 9999px;
            font-size: 0.875rem;
            color: var(--color-text-muted);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .chip:hover {
            background: rgba(30, 41, 59, 0.7);
            transform: translateY(-2px);
        }

        .chip.active {
            background: rgba(16, 185, 129, 0.15);
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .filters-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.25rem;
            padding-top: 1.25rem;
            border-top: 1px solid var(--color-border);
            font-size: 0.875rem;
            color: var(--color-text-muted);
        }

        .clear-filters {
            background: transparent;
            border: none;
            color: var(--color-accent);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .clear-filters:hover {
            color: var(--color-accent-hover);
            transform: translateY(-1px);
        }

        /* Products Grid Premium */
        .products {
            padding: 3rem 0 4rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: var(--transition);
            animation: fadeIn 0.6s ease-out forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--color-border-light);
        }

        .product-image-container {
            position: relative;
            height: 220px;
            background: linear-gradient(135deg, var(--color-bg-secondary), #0f172a);
            overflow: hidden;
        }

        .product-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 0.25rem 0.75rem;
            background: rgba(16, 185, 129, 0.9);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 2;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .product-card:hover .product-image {
            transform: scale(1.1);
        }

        .product-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.9), transparent 60%);
            opacity: 0;
            transition: opacity 0.4s ease;
            display: flex;
            align-items: flex-end;
            padding: 1rem;
            z-index: 3;
        }

        .product-card:hover .product-overlay {
            opacity: 1;
        }

        .overlay-actions {
            display: flex;
            gap: 0.75rem;
            width: 100%;
        }

        .overlay-btn {
            flex: 1;
            padding: 0.625rem;
            background: var(--color-accent);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .overlay-btn:hover {
            background: var(--color-accent-hover);
            transform: translateY(-2px);
        }

        .overlay-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .overlay-btn-wishlist {
            width: 40px;
            height: 40px;
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            color: var(--color-text-muted);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .overlay-btn-wishlist:hover {
            color: var(--color-accent);
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .overlay-btn-wishlist.active {
            background: var(--color-danger);
            color: white;
            border-color: var(--color-danger);
        }

        .product-content {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .product-category {
            font-size: 0.75rem;
            color: var(--color-info);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-price {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--color-accent);
        }

        .product-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--color-text-primary);
            line-height: 1.5;
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 3rem;
        }

        .product-description {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.8rem;
        }

        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .product-tag {
            padding: 0.25rem 0.5rem;
            background: rgba(30, 41, 59, 0.5);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--color-text-muted);
            font-weight: 500;
        }

        .product-actions {
            display: flex;
            gap: 0.75rem;
            padding-top: 1rem;
            border-top: 1px solid var(--color-border);
        }

        .product-action-btn {
            flex: 1;
            padding: 0.625rem;
            background: transparent;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--color-text-muted);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .product-action-btn:hover {
            color: var(--color-accent);
            border-color: var(--color-accent);
            background: rgba(16, 185, 129, 0.1);
        }

        /* Admin Actions */
        .admin-product-actions {
            display: flex;
            gap: 0.75rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(239, 68, 68, 0.2);
        }

        .admin-btn-edit {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--color-warning);
            color: var(--color-warning);
        }

        .admin-btn-edit:hover {
            background: rgba(245, 158, 11, 0.2);
            color: var(--color-warning);
        }

        .admin-btn-delete {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--color-danger);
            color: var(--color-danger);
        }

        .admin-btn-delete:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--color-danger);
        }

        /* Loading & Empty States */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 6rem 0;
            gap: 1.5rem;
        }

        .loading-spinner {
            width: 56px;
            height: 56px;
            border: 3px solid rgba(30, 41, 59, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--color-accent);
            animation: spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.125rem;
            color: var(--color-text-muted);
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 6rem 0;
            display: none;
        }

        .empty-state.show {
            display: block;
        }

        .empty-icon {
            width: 96px;
            height: 96px;
            margin: 0 auto 1.5rem;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-icon i {
            font-size: 2.5rem;
            color: var(--color-text-muted);
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 0.75rem;
        }

        .empty-description {
            color: var(--color-text-muted);
            font-size: 1rem;
        }

        /* Modales Premium */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1.5rem;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-lg);
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--color-border);
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--color-text-primary);
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--color-text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--color-text-primary);
            background: rgba(30, 41, 59, 0.5);
        }

        /* Formularios */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 0.75rem;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.875rem 1rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            color: var(--color-text-primary);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-top: 0.5rem;
            display: block;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--color-accent);
        }

        /* Floating Action Button */
        .fab-add-product {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--color-warning), #d97706);
            border: none;
            border-radius: 50%;
            color: var(--color-bg-primary);
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(245, 158, 11, 0.3);
            transition: var(--transition);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-add-product:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 32px rgba(245, 158, 11, 0.4);
        }

        .fab-add-product.hide {
            opacity: 0;
            visibility: hidden;
            transform: scale(0);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1.25rem 1.75rem;
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            transform: translateX(500px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 360px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .toast-success .toast-icon {
            background: var(--color-accent);
            color: white;
        }

        .toast-error .toast-icon {
            background: var(--color-danger);
            color: white;
        }

        .toast-warning .toast-icon {
            background: var(--color-warning);
            color: var(--color-bg-primary);
        }

        .toast-message {
            color: var(--color-text-primary);
            font-size: 0.875rem;
            font-weight: 500;
            line-height: 1.5;
        }

        /* Login Modal */
        .login-form {
            max-width: 420px;
            margin: 0 auto;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-logo .logo-icon {
            width: 72px;
            height: 72px;
            margin: 0 auto;
        }

        .login-title {
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--color-text-primary);
        }

        .login-subtitle {
            text-align: center;
            color: var(--color-text-muted);
            margin-bottom: 2rem;
            font-size: 0.875rem;
        }

        .login-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--color-danger);
            color: #fecaca;
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        /* --- M√≥dulo de carga avanzada de im√°genes en el formulario --- */
        .image-upload-grid {
            display: grid;
            grid-template-columns: 1.3fr 1fr;
            gap: 1rem;
            align-items: flex-start;
        }

        .image-upload-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.5rem;
            max-height: 180px;
            overflow-y: auto;
            padding: 0.5rem;
            background: rgba(15, 23, 42, 0.7);
            border-radius: var(--radius-sm);
            border: 1px dashed var(--color-border);
        }

        .image-preview-item {
            position: relative;
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .image-preview-item img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            display: block;
        }

        .image-preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            border-radius: 999px;
            border: none;
            background: rgba(15, 23, 42, 0.85);
            color: #f9fafb;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .image-preview-remove:hover {
            background: rgba(239, 68, 68, 0.9);
        }

        @media (max-width: 768px) {
            .image-upload-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.25rem;
            }
            
            .hero-subtitle {
                font-size: 1.25rem;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .modal-content {
                padding: 1.75rem;
            }
            
            .fab-add-product {
                bottom: 1.5rem;
                right: 1.5rem;
                width: 56px;
                height: 56px;
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 0 1rem;
            }
            
            .hero-card, .about-card, .filters-card {
                padding: 1.75rem;
            }
            
            .hero-title {
                font-size: 1.75rem;
            }
            
            .hero-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .form-actions {
                flex-direction: column-reverse;
            }
            
            .form-actions .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->


    <header class="header">
    <div class="container">
        <div class="header-content">
            <a href="#" class="logo">
                <img 
                    src="https://github.com/laboratoriokumipy/kumilab_v.1.0/raw/main/Kumi%20Lab%20-%20Horizontal%20-%20Full%20color%20-%20Fondo%20blanco_page-0001%20(2).jpg" 
                    alt="Laboratorios Kumi" 
                    class="logo-img"
                >
                <div class="logo-text">
                    <h1>Laboratorios Kumi</h1>
                    <p>Productos Fitoterap√©uticos Premium</p>
                </div>
            </a>
            <nav class="nav-buttons">
                <button class="nav-btn admin-btn" id="adminBtn" onclick="handleAdminAction()">
                    <i class="fas fa-user-shield"></i>
                    <span id="adminBtnText">Admin</span>
                    <span class="admin-badge" id="adminBadge" style="display: none;">!</span>
                </button>
                <button class="nav-btn" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="badge" id="cartBadge">0</span>
                </button>
                <button class="nav-btn" onclick="toggleWishlist()">
                    <i class="fas fa-heart"></i>
                    <span class="badge" id="wishlistBadge">0</span>
                </button>
            </nav>
        </div>
    </div>
</header>


    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-grid">
                <div class="hero-card">
                    <h2 class="hero-title">Cat√°logo de Productos Fitoterap√©uticos</h2>
                    <p class="hero-subtitle">Calidad y Naturaleza en Cada Producto</p>
                    <p class="hero-description">
                        Descubra nuestra l√≠nea de productos fitoterap√©uticos elaborados con las mejores plantas medicinales. 
                        Contamos con certificaci√≥n DINAVISA RE N¬∞ 4045 y procesos de fabricaci√≥n que garantizan la m√°xima calidad.
                    </p>
                    <div class="hero-tags">
                        <span class="tag">
                            <i class="fas fa-certificate"></i>
                            Certificado DINAVISA
                        </span>
                        <span class="tag">
                            <i class="fas fa-leaf"></i>
                            100% Natural
                        </span>
                        <span class="tag">
                            <i class="fas fa-flask"></i>
                            Control de Calidad
                        </span>
                        <span class="tag">
                            <i class="fas fa-globe"></i>
                            Exportaci√≥n
                        </span>
                    </div>
                    <div class="hero-buttons">
                        <a href="#productos" class="btn btn-primary">
                            <i class="fas fa-search"></i>
                            Explorar productos
                        </a>
                        <a href="#about" class="btn btn-outline">
                            <i class="fas fa-info-circle"></i>
                            Con√≥cenos
                        </a>
                    </div>
                </div>
                <div class="hero-card metrics-card">
                    <h3>Resumen del Cat√°logo</h3>
                    <div class="metric-item">
                        <span class="metric-label">Productos Activos</span>
                        <span class="metric-value green" id="totalProducts">0</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Categor√≠as</span>
                        <span class="metric-value cyan" id="totalCategories">0</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">En Carrito</span>
                        <span class="metric-value cyan" id="cartCount">0</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Certificaci√≥n</span>
                        <span class="metric-value green" style="font-size: 1rem;">DINAVISA</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about-section" id="about">
        <div class="container">
            <div class="about-card">
                <h2 class="about-title">¬øQui√©nes Somos?</h2>
                <div class="about-content">
                    <div class="about-text">
                        <h3>Laboratorios Kumi E.A.S.</h3>
                        <p>
                            Somos una empresa emergente dedicada al rubro de productos fitoterap√©uticos, 
                            habilitada por la Direcci√≥n Nacional de Vigilancia Sanitaria (DINAVISA) bajo el RE N¬∞ 4045.
                        </p>
                        <p>
                            Nuestra infraestructura propia permite el fraccionamiento y envasado de productos fitoterap√©uticos, 
                            espec√≠ficamente plantas medicinales, facilitando la producci√≥n de una amplia variedad de productos 
                            como polvo para infusiones, mate o terer√©, extractos y t√©s.
                        </p>
                        <p>
                            Contamos con dep√≥sitos habilitados para el almacenamiento de productos fitoterap√©uticos importados, 
                            como t√©s, c√°psulas, jarabes y otros productos derivados de plantas medicinales.
                        </p>
                    </div>
                    <div class="about-features">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="feature-text">
                                <h4>Equipo Profesional</h4>
                                <p>Profesionales del √°rea de la Qu√≠mica con amplia experiencia</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <div class="feature-text">
                                <h4>Sistemas de Calidad</h4>
                                <p>Implementaci√≥n de Buenas Pr√°cticas de Fabricaci√≥n</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-microscope"></i>
                            </div>
                            <div class="feature-text">
                                <h4>Control de Calidad</h4>
                                <p>An√°lisis de plantas medicinales y metabolitos secundarios</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="feature-text">
                                <h4>Consultor√≠a</h4>
                                <p>Regencia y asesoramiento t√©cnico especializado</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="certifications">
                    <h4>
                        <i class="fas fa-certificate"></i>
                        Certificaciones y Servicios Autorizados
                    </h4>
                    <div class="cert-list">
                        <div class="cert-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Representante de Productos Fitoterap√©uticos</span>
                        </div>
                        <div class="cert-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Distribuidora de Productos Fitoterap√©uticos</span>
                        </div>
                        <div class="cert-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Fraccionadora y Envasadora</span>
                        </div>
                        <div class="cert-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Exportadora de Productos Fitoterap√©uticos</span>
                        </div>
                        <div class="cert-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Importadora de Productos Fitoterap√©uticos</span>
                        </div>
                        <div class="cert-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Regencia de Establecimientos Farmac√©uticos</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters Section -->
    <section class="filters" id="productos">
        <div class="container">
            <div class="filters-card">
                <div class="filters-top">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input 
                            type="text" 
                            class="search-input" 
                            placeholder="Buscar por nombre, categor√≠a, etiqueta..."
                            id="searchInput"
                            oninput="filterProducts()"
                        >
                    </div>
                    <select class="sort-select" id="sortSelect" onchange="filterProducts()">
                        <option value="relevance">Relevancia</option>
                        <option value="newest">M√°s recientes</option>
                        <option value="oldest">M√°s antiguos</option>
                        <option value="name_asc">Nombre A-Z</option>
                        <option value="name_desc">Nombre Z-A</option>
                        <option value="price_asc">Precio: Menor a Mayor</option>
                        <option value="price_desc">Precio: Mayor a Menor</option>
                    </select>
                </div>
                <div class="category-chips" id="categoryChips"></div>
                <div class="filters-summary">
                    <span id="resultsCount">0 producto(s) encontrado(s)</span>
                    <button class="clear-filters" onclick="clearFilters()">
                        <i class="fas fa-times"></i>
                        Limpiar filtros
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products">
        <div class="container">
            <div id="loadingState" class="loading">
                <div class="loading-spinner"></div>
                <p class="loading-text">Cargando cat√°logo de productos...</p>
            </div>
            <div id="productsGrid" class="products-grid" style="display: none;"></div>
            <div id="emptyState" class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-search"></i>
                </div>
                <h3 class="empty-title">No se encontraron productos</h3>
                <p class="empty-description">Intenta ajustar tus filtros o buscar con otros t√©rminos</p>
            </div>
        </div>
    </section>

    <!-- Bot√≥n Flotante Agregar Producto (Admin) -->
    <button class="fab-add-product hide" id="fabAddProduct" onclick="showAddProductModal()" title="Agregar Producto">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Modales -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle"></h2>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <div id="cartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Tu Carrito</h2>
                <button class="modal-close" onclick="toggleCart()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="cartContent"></div>
        </div>
    </div>

    <div id="wishlistModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Tus Favoritos</h2>
                <button class="modal-close" onclick="toggleWishlist()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="wishlistContent"></div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="login-form">
                <div class="login-logo">
                    <div class="logo-icon"></div>
                </div>
                <h2 class="login-title">Acceso Administrador</h2>
                <p class="login-subtitle">Ingrese sus credenciales para gestionar productos</p>
                <div class="login-error" id="loginError"></div>
                <div class="form-group">
                    <label class="form-label">Usuario</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="Usuario" autofocus>
                </div>
                <div class="form-group">
                    <label class="form-label">Contrase√±a</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Contrase√±a">
                </div>
                <div class="form-actions">
                    <button class="btn btn-outline" type="button" onclick="closeLoginModal()">Cancelar</button>
                    <button class="btn btn-primary" type="button" onclick="login()">Ingresar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="productFormModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title" id="productFormTitle">Agregar Producto</h2>
                <button class="modal-close" onclick="closeProductFormModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Nombre del Producto *</label>
                        <input type="text" class="form-input" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categor√≠a *</label>
                        <select class="form-input" id="productCategory" required>
                            <option value="">Seleccionar categor√≠a...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripci√≥n *</label>
                        <textarea class="form-textarea" id="productDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Im√°genes del producto</label>
                        <div class="image-upload-grid">
                            <div>
                                <div class="image-upload-buttons">
                                    <label class="btn btn-outline btn-sm">
                                        <i class="fas fa-camera"></i>
                                        <span style="margin-left: 0.35rem;">C√°mara / Archivo</span>
                                        <input type="file" id="imageFileInput" accept="image/*" multiple capture="environment" hidden>
                                    </label>
                                    <button type="button" class="btn btn-outline btn-sm" onclick="promptDriveImageUrl()">
                                        <i class="fab fa-google-drive"></i>
                                        <span style="margin-left: 0.35rem;">Desde Drive</span>
                                    </button>
                                    <button type="button" class="btn btn-outline btn-sm" onclick="promptManualImageUrl()">
                                        <i class="fas fa-link"></i>
                                        <span style="margin-left: 0.35rem;">Pegar URL</span>
                                    </button>
                                </div>
                                <p class="form-hint">
                                    Puede tomar fotos con la c√°mara del dispositivo, seleccionar archivos locales 
                                    o pegar enlaces compartidos de Google Drive ubicados en la carpeta configurada.
                                </p>
                            </div>
                            <div class="image-preview-grid" id="imagePreviewGrid">
                                <span style="font-size: 0.75rem; color: var(--color-text-muted);">
                                    Todav√≠a no se han seleccionado im√°genes.
                                </span>
                            </div>
                        </div>
                        <input type="hidden" id="productImages">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Etiquetas (separadas por coma)</label>
                        <input type="text" class="form-input" id="productTags" placeholder="digestivo, natural, hierbas">
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Precio (Gs) *</label>
                            <input type="number" class="form-input" id="productPrice" min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Stock *</label>
                            <input type="number" class="form-input" id="productStock" min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">SKU *</label>
                            <input type="text" class="form-input" id="productSku" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unidad</label>
                            <input type="text" class="form-input" id="productUnit" placeholder="g, ml, cps">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Presentaci√≥n</label>
                        <input type="text" class="form-input" id="productPresentation" placeholder="100g, 200ml, 60 c√°psulas">
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="productFeatured">
                        <label for="productFeatured" class="form-label">Producto Destacado</label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeProductFormModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="saveProductBtn">Guardar Producto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // Estado de la aplicaci√≥n
        let products = [];
        let filteredProducts = [];
        let cart = [];
        let wishlist = [];
        let selectedCategory = '';
        let isAdmin = false;
        let editingProductId = null;

        // Integraci√≥n con Google Sheets / Drive
        const SHEET_ID = '1JFF44nFhV0HBm7L3o2f8_UzOHtGyZ255tNFAB1xniHs';
        const DRIVE_FOLDER_ID = '1w6G3v60iCmbeUxDCguGg_3M96aKdF6nY';
        // URL del Web App de Apps Script que debe escribir en la hoja y guardar archivos en la carpeta indicada.
        // Si se deja vac√≠o, el sistema funcionar√° s√≥lo con localStorage (sin escribir en Sheets/Drive).
        const SHEET_WEBAPP_URL = '';

        // Buffers temporales para las im√°genes del formulario actual
        let imageUrlsBuffer = [];
        let imageFilesBuffer = [];

        // Credenciales de admin (en producci√≥n deber√≠a ir en backend)
        const ADMIN_CREDENTIALS = { username: 'dbaza', password: '1234' };

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            checkAdminSession();
            loadProducts();
            updateMetrics();

            const imageInput = document.getElementById('imageFileInput');
            if (imageInput) {
                imageInput.addEventListener('change', handleImageFileSelection);
            }
            resetImageBuffers();
        });

        // Verificar sesi√≥n de admin
        function checkAdminSession() {
            const session = localStorage.getItem('kumi-admin-session');
            if (session) {
                const sessionData = JSON.parse(session);
                if (sessionData.isActive && (Date.now() - sessionData.timestamp < 24 * 60 * 60 * 1000)) {
                    activateAdminMode();
                } else {
                    localStorage.removeItem('kumi-admin-session');
                }
            }
        }

        // Cargar productos desde localStorage o sample si es primera vez
        function loadProducts() {
            setTimeout(() => {
                const savedProducts = localStorage.getItem('kumi-products');
                if (savedProducts) {
                    products = JSON.parse(savedProducts);
                } else {
                    products = [...sampleProducts];
                    saveProductsToStorage();
                }
                filteredProducts = [...products];
                renderCategories();
                renderProducts();
                updateMetrics();
                
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('productsGrid').style.display = 'grid';
            }, 800);
        }

        // Guardar productos en localStorage
        function saveProductsToStorage() {
            localStorage.setItem('kumi-products', JSON.stringify(products));
        }

        // Cargar desde localStorage
        function loadFromLocalStorage() {
            const savedCart = localStorage.getItem('kumi-cart');
            const savedWishlist = localStorage.getItem('kumi-wishlist');
            
            if (savedCart) cart = JSON.parse(savedCart);
            if (savedWishlist) wishlist = JSON.parse(savedWishlist);
            
            updateBadges();
        }

        // Guardar en localStorage
        function saveToLocalStorage() {
            localStorage.setItem('kumi-cart', JSON.stringify(cart));
            localStorage.setItem('kumi-wishlist', JSON.stringify(wishlist));
        }

        // Manejar acci√≥n del bot√≥n admin
        function handleAdminAction() {
            if (isAdmin) {
                logout();
            } else {
                showLoginModal();
            }
        }

        // Mostrar modal de login
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('show');
            const userInput = document.getElementById('loginUsername');
            if (userInput) {
                userInput.focus();
            }
        }

        // Cerrar modal de login
        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('show');
            document.getElementById('loginError').classList.remove('show');
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Login
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                activateAdminMode();
                closeLoginModal();
                showToast('Acceso concedido. Modo administrador activado.', 'success');
            } else {
                const errorEl = document.getElementById('loginError');
                errorEl.textContent = 'Credenciales inv√°lidas. Usuario: dbaza, Contrase√±a: 1234';
                errorEl.classList.add('show');
            }
        }

        // Activar modo admin
        function activateAdminMode() {
            isAdmin = true;
            const adminBtnText = document.getElementById('adminBtnText');
            const adminBadge = document.getElementById('adminBadge');
            const fabAddProduct = document.getElementById('fabAddProduct');
            
            adminBtnText.textContent = 'Salir Admin';
            adminBadge.style.display = 'flex';
            fabAddProduct.classList.remove('hide');
            
            localStorage.setItem('kumi-admin-session', JSON.stringify({
                isActive: true,
                timestamp: Date.now()
            }));
            
            renderProducts();
        }

        // Logout
        function logout() {
            isAdmin = false;
            const adminBtnText = document.getElementById('adminBtnText');
            const adminBadge = document.getElementById('adminBadge');
            const fabAddProduct = document.getElementById('fabAddProduct');
            
            adminBtnText.textContent = 'Admin';
            adminBadge.style.display = 'none';
            fabAddProduct.classList.add('hide');
            
            localStorage.removeItem('kumi-admin-session');
            
            renderProducts();
            showToast('Sesi√≥n de administrador cerrada.', 'warning');
        }

        // --- Manejo de im√°genes en el formulario ---
        function resetImageBuffers() {
            imageFilesBuffer = [];
            imageUrlsBuffer = [];
            renderImagePreview();
            syncImageUrlsToHiddenInput();
        }

        function handleImageFileSelection(event) {
            const files = Array.from(event.target.files || []);
            if (!files.length) return;

            files.forEach(file => {
                const objectUrl = URL.createObjectURL(file);
                imageFilesBuffer.push({ url: objectUrl, file });
                imageUrlsBuffer.push(objectUrl);
            });

            renderImagePreview();
            syncImageUrlsToHiddenInput();
            event.target.value = '';

            if (!SHEET_WEBAPP_URL) {
                showToast(
                    'Las im√°genes capturadas se ver√°n en este dispositivo. Para guardarlas en Google Drive configure SHEET_WEBAPP_URL.',
                    'warning'
                );
            }
        }

        function promptManualImageUrl() {
            const url = prompt('Pegue la URL directa de la imagen (http(s)://...)');
            if (url && url.trim()) {
                imageUrlsBuffer.push(url.trim());
                renderImagePreview();
                syncImageUrlsToHiddenInput();
            }
        }

        function promptDriveImageUrl() {
            const url = prompt('Pegue el enlace compartido de la imagen en su carpeta de Google Drive.');
            if (url && url.trim()) {
                imageUrlsBuffer.push(url.trim());
                renderImagePreview();
                syncImageUrlsToHiddenInput();
            }
        }

        function removeImageAt(index) {
            if (index < 0 || index >= imageUrlsBuffer.length) return;
            const url = imageUrlsBuffer[index];
            imageUrlsBuffer.splice(index, 1);

            const fileIndex = imageFilesBuffer.findIndex(item => item.url === url);
            if (fileIndex !== -1) {
                URL.revokeObjectURL(imageFilesBuffer[fileIndex].url);
                imageFilesBuffer.splice(fileIndex, 1);
            }

            renderImagePreview();
            syncImageUrlsToHiddenInput();
        }

        function renderImagePreview() {
            const container = document.getElementById('imagePreviewGrid');
            if (!container) return;

            if (!imageUrlsBuffer.length) {
                container.innerHTML = `
                    <span style="font-size: 0.75rem; color: var(--color-text-muted);">
                        Todav√≠a no se han seleccionado im√°genes.
                    </span>
                `;
                return;
            }

            container.innerHTML = imageUrlsBuffer.map((url, index) => `
                <div class="image-preview-item">
                    <img src="${url}" alt="Imagen ${index + 1}">
                    <button type="button" class="image-preview-remove" onclick="removeImageAt(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function syncImageUrlsToHiddenInput() {
            const input = document.getElementById('productImages');
            if (input) {
                input.value = imageUrlsBuffer.join(', ');
            }
        }

        // WebApp backend sync
        async function syncProductWithBackend(productData) {
            if (!SHEET_WEBAPP_URL) {
                return productData;
            }

            const formData = new FormData();
            formData.append('action', 'saveProduct');
            formData.append('sheetId', SHEET_ID);
            formData.append('folderId', DRIVE_FOLDER_ID);
            formData.append('product', JSON.stringify(productData));

            imageFilesBuffer.forEach((item, index) => {
                formData.append('file' + index, item.file, item.file.name);
            });

            const response = await fetch(SHEET_WEBAPP_URL, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error('Error HTTP ' + response.status);
            }

            let data;
            try {
                data = await response.json();
            } catch (e) {
                throw new Error('Respuesta no v√°lida del backend');
            }

            if (data && Array.isArray(data.imageUrls) && data.imageUrls.length) {
                const nonFileUrls = productData.imagenes.filter(
                    url => !imageFilesBuffer.some(item => item.url === url)
                );
                productData.imagenes = nonFileUrls.concat(data.imageUrls);

                imageFilesBuffer.forEach(item => URL.revokeObjectURL(item.url));
                imageFilesBuffer = [];
                imageUrlsBuffer = productData.imagenes.slice();
                renderImagePreview();
                syncImageUrlsToHiddenInput();
            }

            if (data && typeof data.rowIndex !== 'undefined') {
                productData.sheetRow = data.rowIndex;
            }

            return productData;
        }

        // Mostrar modal de agregar producto
        function showAddProductModal() {
            editingProductId = null;
            document.getElementById('productFormTitle').textContent = 'Agregar Nuevo Producto';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = generateId();
            resetImageBuffers();
            document.getElementById('productFormModal').classList.add('show');
            loadCategoriesInSelect();
        }

        // Mostrar modal de editar producto
        function showEditProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            editingProductId = productId;
            document.getElementById('productFormTitle').textContent = 'Editar Producto';
            document.getElementById('productId').value = product.id;
            document.getElementById('productName').value = product.nombre;
            document.getElementById('productCategory').value = product.categoria;
            document.getElementById('productDescription').value = product.descripcion;
            document.getElementById('productTags').value = product.etiquetas.join(', ');
            document.getElementById('productPrice').value = product.precio;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productSku').value = product.sku;
            document.getElementById('productUnit').value = product.unidad || '';
            document.getElementById('productPresentation').value = product.presentacion || '';
            document.getElementById('productFeatured').checked = product.destacado || false;

            imageFilesBuffer = [];
            imageUrlsBuffer = Array.isArray(product.imagenes) ? [...product.imagenes] : [];
            syncImageUrlsToHiddenInput();
            renderImagePreview();
            
            document.getElementById('productFormModal').classList.add('show');
            loadCategoriesInSelect();
        }

        // Cargar categor√≠as en el select del formulario
        function loadCategoriesInSelect() {
            const select = document.getElementById('productCategory');
            const categories = [...new Set(products.map(p => p.categoria))].sort();
            
            select.innerHTML = '<option value="">Seleccionar categor√≠a...</option>';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
            
            const newOption = document.createElement('option');
            newOption.value = '__new__';
            newOption.textContent = '+ Agregar nueva categor√≠a...';
            select.appendChild(newOption);
            
            select.onchange = function() {
                if (this.value === '__new__') {
                    const newCat = prompt('Ingrese el nombre de la nueva categor√≠a:');
                    if (newCat && newCat.trim()) {
                        const option = document.createElement('option');
                        option.value = newCat.trim();
                        option.textContent = newCat.trim();
                        option.selected = true;
                        select.insertBefore(option, select.lastElementChild);
                    } else {
                        this.value = '';
                    }
                }
            };
        }

        // Cerrar modal de producto
        function closeProductFormModal() {
            document.getElementById('productFormModal').classList.remove('show');
            editingProductId = null;
        }

        // Guardar producto
        async function saveProduct(event) {
            event.preventDefault();
            
            let imagenes = imageUrlsBuffer.slice();
            if (!imagenes.length) {
                const raw = document.getElementById('productImages').value || '';
                if (raw.trim()) {
                    imagenes = raw.split(',').map(u => u.trim()).filter(u => u);
                }
            }

            const existing = editingProductId ? products.find(p => p.id === editingProductId) : null;

            const productData = {
                id: document.getElementById('productId').value,
                nombre: document.getElementById('productName').value.trim(),
                categoria: document.getElementById('productCategory').value,
                descripcion: document.getElementById('productDescription').value.trim(),
                imagenes,
                etiquetas: document.getElementById('productTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                precio: parseInt(document.getElementById('productPrice').value, 10) || 0,
                stock: parseInt(document.getElementById('productStock').value, 10) || 0,
                sku: document.getElementById('productSku').value.trim(),
                unidad: document.getElementById('productUnit').value.trim(),
                presentacion: document.getElementById('productPresentation').value.trim(),
                destacado: document.getElementById('productFeatured').checked,
                creado: existing && existing.creado ? existing.creado : new Date().toISOString().split('T')[0]
            };
            
            if (!productData.nombre || !productData.categoria || !productData.descripcion || !productData.sku) {
                showToast('Por favor completa todos los campos obligatorios.', 'error');
                return;
            }

            let finalProduct = productData;
            try {
                finalProduct = await syncProductWithBackend(productData);
            } catch (e) {
                console.error(e);
                showToast('No se pudo sincronizar con Google Sheets / Drive. El producto se guardar√° solo en este dispositivo.', 'warning');
            }
            
            if (editingProductId) {
                const index = products.findIndex(p => p.id === editingProductId);
                if (index !== -1) {
                    products[index] = { ...finalProduct };
                }
                showToast('Producto actualizado correctamente.', 'success');
            } else {
                products.push(finalProduct);
                showToast('Producto agregado correctamente.', 'success');
            }
            
            saveProductsToStorage();
            filteredProducts = [...products];
            renderCategories();
            renderProducts();
            updateMetrics();
            closeProductFormModal();
        }

        // Eliminar producto
        function deleteProduct(productId) {
            if (!confirm('¬øEst√°s seguro de eliminar este producto? Esta acci√≥n no se puede deshacer.')) {
                return;
            }
            
            products = products.filter(p => p.id !== productId);
            saveProductsToStorage();
            filteredProducts = filteredProducts.filter(p => p.id !== productId);
            
            renderCategories();
            renderProducts();
            updateMetrics();
            showToast('Producto eliminado correctamente.', 'warning');
        }

        // Generar ID √∫nico
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Render categor√≠as (chips)
        function renderCategories() {
            const categories = [...new Set(products.map(p => p.categoria))].sort();
            const container = document.getElementById('categoryChips');
            
            container.innerHTML = `
                <div class="chip ${selectedCategory === '' ? 'active' : ''}" onclick="selectCategory('')">
                    Todas
                </div>
            `;
            
            categories.forEach(category => {
                const chip = document.createElement('div');
                chip.className = `chip ${selectedCategory === category ? 'active' : ''}`;
                chip.textContent = category;
                chip.onclick = () => selectCategory(category);
                container.appendChild(chip);
            });
        }

        function selectCategory(category) {
            selectedCategory = category;
            renderCategories();
            filterProducts();
        }

        function filterProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const sortBy = document.getElementById('sortSelect').value;
            
            filteredProducts = products.filter(product => {
                const matchesSearch = !searchTerm || 
                    product.nombre.toLowerCase().includes(searchTerm) ||
                    product.descripcion.toLowerCase().includes(searchTerm) ||
                    product.categoria.toLowerCase().includes(searchTerm) ||
                    product.etiquetas.some(tag => tag.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !selectedCategory || product.categoria === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });
            
            switch (sortBy) {
                case 'newest':
                    filteredProducts.sort((a, b) => (b.creado || '').localeCompare(a.creado || ''));
                    break;
                case 'oldest':
                    filteredProducts.sort((a, b) => (a.creado || '').localeCompare(b.creado || ''));
                    break;
                case 'name_asc':
                    filteredProducts.sort((a, b) => a.nombre.localeCompare(b.nombre));
                    break;
                case 'name_desc':
                    filteredProducts.sort((a, b) => b.nombre.localeCompare(a.nombre));
                    break;
                case 'price_asc':
                    filteredProducts.sort((a, b) => (a.precio || 0) - (b.precio || 0));
                    break;
                case 'price_desc':
                    filteredProducts.sort((a, b) => (b.precio || 0) - (a.precio || 0));
                    break;
                // relevancia: sin orden adicional
            }
            
            renderProducts();
        }

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (filteredProducts.length === 0) {
                grid.style.display = 'none';
                emptyState.classList.add('show');
                document.getElementById('resultsCount').textContent = '0 producto(s) encontrado(s)';
                return;
            }
            
            grid.style.display = 'grid';
            emptyState.classList.remove('show');
            document.getElementById('resultsCount').textContent = `${filteredProducts.length} producto(s) encontrado(s)`;
            
            grid.innerHTML = filteredProducts.map((product, index) => {
                const isInCart = cart.some(item => item.id === product.id);
                const isInWishlist = wishlist.some(item => item.id === product.id);
                const imageSrc = (product.imagenes && product.imagenes[0]) ? product.imagenes[0] : 'https://picsum.photos/seed/default/400/300.jpg';
                
                return `
                    <div class="product-card" style="animation-delay: ${index * 0.05}s">
                        <div class="product-image-container">
                            <img src="${imageSrc}" alt="${product.nombre}" class="product-image">
                            ${product.destacado ? '<div class="product-badge">Destacado</div>' : ''}
                            <div class="product-overlay">
                                <div class="overlay-actions">
                                    <button class="overlay-btn" onclick="addToCart('${product.id}')" ${isInCart ? 'disabled' : ''}>
                                        <i class="fas fa-cart-plus"></i> ${isInCart ? '‚úì' : 'Agregar'}
                                    </button>
                                    <button class="overlay-btn-wishlist ${isInWishlist ? 'active' : ''}" onclick="toggleWishlistItem('${product.id}')">
                                        <i class="fas fa-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="product-content">
                            <div class="product-header">
                                <span class="product-category">${product.categoria}</span>
                                <span class="product-price">Gs. ${product.precio.toLocaleString()}</span>
                            </div>
                            <h3 class="product-name">${product.nombre}</h3>
                            <p class="product-description">${product.descripcion}</p>
                            <div class="product-tags">
                                ${product.etiquetas.slice(0, 3).map(tag => `<span class="product-tag">${tag}</span>`).join('')}
                            </div>
                            <div class="product-actions">
                                <button class="product-action-btn" onclick="showProductModal('${product.id}')">
                                    <i class="fas fa-info-circle"></i> Detalles
                                </button>
                                <button class="product-action-btn" onclick="addToCart('${product.id}')" ${isInCart ? 'disabled' : ''}>
                                    <i class="fas fa-shopping-cart"></i> ${isInCart ? '‚úì Agregado' : 'Agregar'}
                                </button>
                            </div>
                            ${isAdmin ? `
                                <div class="admin-product-actions">
                                    <button class="product-action-btn admin-btn-edit" onclick="showEditProductModal('${product.id}')">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="product-action-btn admin-btn-delete" onclick="deleteProduct('${product.id}')">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMetrics() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalCategories').textContent = [...new Set(products.map(p => p.categoria))].length;
            document.getElementById('cartCount').textContent = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
        }

        function updateBadges() {
            document.getElementById('cartBadge').textContent = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            document.getElementById('wishlistBadge').textContent = wishlist.length;
        }

        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast show toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <div class="toast-icon">
                        <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-check'}"></i>
                    </div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('sortSelect').value = 'relevance';
            selectedCategory = '';
            filterProducts();
        }

        // Carrito y wishlist
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity = (existingItem.quantity || 1) + 1;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            
            saveToLocalStorage();
            updateBadges();
            updateMetrics();
            renderProducts();
            showToast(`${product.nombre} agregado al carrito`, 'success');
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveToLocalStorage();
            updateBadges();
            updateMetrics();
            renderCart();
        }

        function toggleWishlistItem(productId) {
            const product = products.find(p => p.id === productId);
            const existingItem = wishlist.find(item => item.id === productId);
            
            if (existingItem) {
                wishlist = wishlist.filter(item => item.id !== productId);
                showToast(`${product.nombre} eliminado de favoritos`, 'warning');
            } else {
                wishlist.push(product);
                showToast(`${product.nombre} agregado a favoritos`, 'success');
            }
            
            saveToLocalStorage();
            updateBadges();
            renderProducts();
        }

        function toggleCart() {
            const modal = document.getElementById('cartModal');
            modal.classList.toggle('show');
            renderCart();
        }

        function toggleWishlist() {
            const modal = document.getElementById('wishlistModal');
            modal.classList.toggle('show');
            renderWishlist();
        }

        function renderCart() {
            const content = document.getElementById('cartContent');
            if (cart.length === 0) {
                content.innerHTML = `
                    <div class="empty-state show">
                        <div class="empty-icon"><i class="fas fa-shopping-cart"></i></div>
                        <h3 class="empty-title">Tu carrito est√° vac√≠o</h3>
                        <p class="empty-description">Agrega productos para comenzar</p>
                    </div>
                `;
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.precio * (item.quantity || 1)), 0);
            content.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 1rem; max-height: 400px; overflow-y: auto;">
                    ${cart.map(item => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
                            <div>
                                <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem;">${item.nombre}</h4>
                                <p style="font-size: 0.75rem; color: var(--color-text-muted);">Cantidad: ${item.quantity || 1} √ó Gs. ${item.precio.toLocaleString()}</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-weight: 700; color: var(--color-accent);">Gs. ${(item.precio * (item.quantity || 1)).toLocaleString()}</span>
                                <button class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" onclick="removeFromCart('${item.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--color-border);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <span style="font-size: 1.25rem; font-weight: 700;">Total:</span>
                        <span style="font-size: 1.5rem; font-weight: 700; color: var(--color-accent);">Gs. ${total.toLocaleString()}</span>
                    </div>
                    <button class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-check"></i> Finalizar Compra
                    </button>
                </div>
            `;
        }

        function renderWishlist() {
            const content = document.getElementById('wishlistContent');
            if (wishlist.length === 0) {
                content.innerHTML = `
                    <div class="empty-state show">
                        <div class="empty-icon"><i class="fas fa-heart"></i></div>
                        <h3 class="empty-title">No tienes favoritos</h3>
                        <p class="empty-description">Guarda productos que te interesen</p>
                    </div>
                `;
                return;
            }
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                    ${wishlist.map(item => {
                        const imageSrc = (item.imagenes && item.imagenes[0]) ? item.imagenes[0] : 'https://picsum.photos/seed/default/400/300.jpg';
                        return `
                        <div style="padding: 1rem; background: rgba(30, 41, 59, 0.5); border-radius: 8px; border: 1px solid var(--color-border);">
                            <img src="${imageSrc}" alt="${item.nombre}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 4px; margin-bottom: 0.5rem;">
                            <h4 style="font-size: 0.875rem; margin-bottom: 0.25rem;">${item.nombre}</h4>
                            <p style="font-size: 0.75rem; color: var(--color-accent); font-weight: 700;">Gs. ${item.precio.toLocaleString()}</p>
                            <div style="display: flex; gap: 0.5rem; margin-top: 0.75rem;">
                                <button class="btn btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; flex: 1;" onclick="addToCart('${item.id}')">
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                                <button class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" onclick="removeFromWishlist('${item.id}')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>`;
                    }).join('')}
                </div>
            `;
        }

        function removeFromWishlist(productId) {
            wishlist = wishlist.filter(item => item.id !== productId);
            saveToLocalStorage();
            updateBadges();
            renderWishlist();
            renderProducts();
        }

        function showProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const imageSrc = (product.imagenes && product.imagenes[0]) ? product.imagenes[0] : 'https://picsum.photos/seed/default/400/300.jpg';
            
            document.getElementById('modalTitle').textContent = product.nombre;
            document.getElementById('modalBody').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr; gap: 1.5rem;">
                    <img src="${imageSrc}" alt="${product.nombre}" style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px;">
                    <div>
                        <h3 style="color: var(--color-info); font-size: 0.875rem; margin-bottom: 0.5rem;">${product.categoria}</h3>
                        <p style="font-size: 1.5rem; font-weight: 700; color: var(--color-accent); margin-bottom: 1rem;">Gs. ${product.precio.toLocaleString()}</p>
                        <p style="color: var(--color-text-secondary); line-height: 1.6; margin-bottom: 1.5rem;">${product.descripcion}</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--color-border);">
                                <span style="color: var(--color-text-muted);">SKU:</span>
                                <span style="font-weight: 600;">${product.sku}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--color-border);">
                                <span style="color: var(--color-text-muted);">Stock:</span>
                                <span style="font-weight: 600;">${product.stock}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--color-border);">
                                <span style="color: var(--color-text-muted);">Unidad:</span>
                                <span style="font-weight: 600;">${product.unidad || '-'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--color-border);">
                                <span style="color: var(--color-text-muted);">Presentaci√≥n:</span>
                                <span style="font-weight: 600;">${product.presentacion || '-'}</span>
                            </div>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem;">
                            ${product.etiquetas.map(tag => `<span style="padding: 0.25rem 0.5rem; background: rgba(30, 41, 59, 0.5); border-radius: 4px; font-size: 0.75rem; color: var(--color-text-muted);">#${tag}</span>`).join('')}
                        </div>
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="addToCart('${product.id}'); closeModal();">
                                <i class="fas fa-shopping-cart"></i> Agregar al Carrito
                            </button>
                            <button class="btn btn-outline" style="flex: 1;" onclick="toggleWishlistItem('${product.id}');">
                                <i class="fas fa-heart"></i> ${wishlist.some(item => item.id === product.id) ? 'Quitar Favorito' : 'A√±adir Favorito'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('productModal').classList.add('show');
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));
        }

        // Cerrar modales al hacer click fuera
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });

        // Datos de ejemplo
        const sampleProducts = [
            {
                id: "1",
                nombre: "Boldo en Hojas - Polvo para Infusi√≥n",
                categoria: "Plantas Medicinales",
                precio: 25000,
                descripcion: "Boldo (Peumus boldus) de alta calidad, ideal para infusiones digestivas. Propiedades hepatoprotectoras y colagogas.",
                imagenes: ["https://picsum.photos/seed/boldo/400/300.jpg"],
                etiquetas: ["digestivo", "h√≠gado", "natural"],
                stock: 50,
                sku: "BOL001",
                unidad: "g",
                presentacion: "100g",
                destacado: true,
                creado: "2023-05-15"
            },
            {
                id: "2",
                nombre: "T√© Verde Sencha Premium",
                categoria: "T√©s e Infusiones",
                precio: 45000,
                descripcion: "T√© verde japon√©s de alta calidad, rico en antioxidantes y catequinas. Ideal para metabolismo y concentraci√≥n.",
                imagenes: ["https://picsum.photos/seed/teverde/400/300.jpg"],
                etiquetas: ["antioxidante", "metabolismo", "energ√≠a"],
                stock: 30,
                sku: "TVS002",
                unidad: "g",
                presentacion: "200g",
                destacado: true,
                creado: "2023-06-20"
            },
            {
                id: "3",
                nombre: "Manzanilla Flores - Infusi√≥n Relajante",
                categoria: "Plantas Medicinales",
                precio: 22000,
                descripcion: "Manzanilla (Matricaria chamomilla) de cultivo org√°nico. Propiedades calmantes y antiinflamatorias.",
                imagenes: ["https://picsum.photos/seed/manzanilla/400/300.jpg"],
                etiquetas: ["relajante", "sue√±o", "antiinflamatorio"],
                stock: 40,
                sku: "MAN003",
                unidad: "g",
                presentacion: "50g",
                destacado: false,
                creado: "2023-04-10"
            },
            {
                id: "4",
                nombre: "C√°psulas de Valeriana 500mg",
                categoria: "Fitoter√°picos",
                precio: 68000,
                descripcion: "Extracto de valeriana estandarizado. Ayuda a mejorar la calidad del sue√±o y reducir la ansiedad.",
                imagenes: ["https://picsum.photos/seed/valeriana/400/300.jpg"],
                etiquetas: ["sue√±o", "ansiedad", "relajaci√≥n"],
                stock: 25,
                sku: "VAL004",
                unidad: "cps",
                presentacion: "60 c√°psulas",
                destacado: true,
                creado: "2023-07-05"
            },
            {
                id: "5",
                nombre: "Jengibre en Ra√≠z - Polvo",
                categoria: "Especias Medicinales",
                precio: 35000,
                descripcion: "Jengibre (Zingiber officinale) deshidratado y molido. Propiedades antiinflamatorias y digestivas.",
                imagenes: ["https://picsum.photos/seed/jengibre/400/300.jpg"],
                etiquetas: ["antiinflamatorio", "digestivo", "inmunidad"],
                stock: 35,
                sku: "JIN005",
                unidad: "g",
                presentacion: "100g",
                destacado: false,
                creado: "2023-08-12"
            }
        ];
    </script>
</body>
</html>
